<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>错误处理 - JavaScript快速上手</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: #f8f9fa;
            color: #333;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .breadcrumb {
            color: #7f8c8d;
            margin-bottom: 15px;
        }
        
        .content {
            margin-bottom: 30px;
        }
        
        h2 {
            color: #34495e;
            margin: 25px 0 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        
        h3 {
            color: #555;
            margin: 20px 0 12px;
        }
        
        p {
            margin-bottom: 15px;
            line-height: 1.8;
        }
        
        .code-block {
            background: #2d3648;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        
        .code-comment {
            color: #637777;
        }
        
        .code-keyword {
            color: #c792ea;
        }
        
        .code-variable {
            color: #ffcb6b;
        }
        
        .code-string {
            color: #c3e88d;
        }
        
        .code-number {
            color: #f78c6c;
        }
        
        .code-function {
            color: #82aaff;
        }
        
        .code-boolean {
            color: #ff5874;
        }
        
        .error-diagram {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        
        .key-features {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin: 25px 0;
        }
        
        .key-features h3 {
            color: #0d47a1;
            margin-bottom: 15px;
        }
        
        .key-features ul {
            padding-left: 25px;
        }
        
        .key-features li {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .comparison-item {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .comparison-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .practice {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 8px;
            margin: 25px 0;
        }
        
        .practice h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }
        
        .practice ul {
            padding-left: 25px;
        }
        
        .practice li {
            margin-bottom: 10px;
        }
        
        .error-example {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        
        .error-example-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        nav {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .nav-link {
            display: inline-block;
            padding: 10px 20px;
            background: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin: 0 10px;
        }
        
        .nav-link:hover {
            background: #2980b9;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="breadcrumb">JavaScript快速上手 > 进阶特性 > 错误处理</div>
            <h1>错误处理</h1>
        </header>
        
        <div class="content">
            <p>错误处理是JavaScript编程中的重要部分，它帮助我们优雅地处理程序中的异常情况，提高应用的稳定性和用户体验。掌握错误处理机制是成为JavaScript高手的关键技能。</p>
            
            <div class="key-features">
                <h3>错误处理概览</h3>
                <ul>
                    <li><strong>try/catch/finally</strong>：基本错误捕获机制</li>
                    <li><strong>Error对象</strong>：错误信息的标准化表示</li>
                    <li><strong>自定义错误类型</strong>：针对特定场景的错误处理</li>
                    <li><strong>异步错误处理</strong>：Promise和async/await的错误处理</li>
                    <li><strong>错误传播</strong>：错误在调用栈中的传递机制</li>
                    <li><strong>全局错误处理</strong>：捕获未处理的错误</li>
                </ul>
            </div>
            
            <h2>JavaScript错误类型</h2>
            <p>JavaScript内置了多种错误类型，每种类型对应不同的错误情况。</p>
            
            <div class="code-block">
                <span class="code-comment">// 常见错误类型示例</span><br><br>
                
                <span class="code-comment">// SyntaxError - 语法错误</span><br>
                <span class="code-comment">// const a = ; // 语法错误，无法执行</span><br><br>
                
                <span class="code-comment">// ReferenceError - 引用错误</span><br>
                <span class="code-keyword">try</span> {<br>
                &nbsp;&nbsp;console.log(undefinedVariable); <span class="code-comment">// ReferenceError</span><br>
                } <span class="code-keyword">catch</span> (error) {<br>
                &nbsp;&nbsp;console.log(error.name); <span class="code-comment">// "ReferenceError"</span><br>
                &nbsp;&nbsp;console.log(error.message); <span class="code-comment">// "undefinedVariable is not defined"</span><br>
                }<br><br>
                
                <span class="code-comment">// TypeError - 类型错误</span><br>
                <span class="code-keyword">try</span> {<br>
                &nbsp;&nbsp;<span class="code-keyword">const</span> num = <span class="code-number">5</span>;<br>
                &nbsp;&nbsp;num.toUpperCase(); <span class="code-comment">// TypeError</span><br>
                } <span class="code-keyword">catch</span> (error) {<br>
                &nbsp;&nbsp;console.log(error.name); <span class="code-comment">// "TypeError"</span><br>
                &nbsp;&nbsp;console.log(error.message); <span class="code-comment">// "num.toUpperCase is not a function"</span><br>
                }<br><br>
                
                <span class="code-comment">// RangeError - 范围错误</span><br>
                <span class="code-keyword">try</span> {<br>
                &nbsp;&nbsp;<span class="code-keyword">new</span> Array(-<span class="code-number">1</span>); <span class="code-comment">// RangeError</span><br>
                } <span class="code-keyword">catch</span> (error) {<br>
                &nbsp;&nbsp;console.log(error.name); <span class="code-comment">// "RangeError"</span><br>
                &nbsp;&nbsp;console.log(error.message); <span class="code-comment">// "Invalid array length"</span><br>
                }
            </div>
            
            <h2>try/catch/finally语句</h2>
            <p>try/catch/finally是JavaScript中处理错误的主要机制。</p>
            
            <div class="code-block">
                <span class="code-keyword">function</span> divide(a, b) {<br>
                &nbsp;&nbsp;<span class="code-keyword">try</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">if</span> (b === <span class="code-number">0</span>) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">throw</span> <span class="code-keyword">new</span> Error(<span class="code-string">"除数不能为零"</span>); <span class="code-comment">// 抛出自定义错误</span><br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br><br>
                
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> result = a / b;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> result;<br>
                &nbsp;&nbsp;} <span class="code-keyword">catch</span> (error) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.error(<span class="code-string">"计算错误:"</span>, error.message);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> <span class="code-boolean">null</span>; <span class="code-comment">// 返回默认值</span><br>
                &nbsp;&nbsp;} <span class="code-keyword">finally</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">"计算操作完成"</span>); <span class="code-comment">// 无论是否出错都会执行</span><br>
                &nbsp;&nbsp;}<br>
                }<br><br>
                
                console.log(divide(<span class="code-number">10</span>, <span class="code-number">2</span>)); <span class="code-comment">// 5, "计算操作完成"</span><br>
                console.log(divide(<span class="code-number">10</span>, <span class="code-number">0</span>)); <span class="code-comment">// null, "计算错误: 除数不能为零", "计算操作完成"</span><br><br>
                
                <span class="code-comment">// 嵌套try/catch</span><br>
                <span class="code-keyword">function</span> nestedTryCatch() {<br>
                &nbsp;&nbsp;<span class="code-keyword">try</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">"外层try"</span>);<br><br>
                
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">try</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">"内层try"</span>);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">throw</span> <span class="code-keyword">new</span> Error(<span class="code-string">"内层错误"</span>);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;} <span class="code-keyword">catch</span> (innerError) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">"内层catch"</span>, innerError.message);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">throw</span> innerError; <span class="code-comment">// 重新抛出错误到外层</span><br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br><br>
                
                &nbsp;&nbsp;} <span class="code-keyword">catch</span> (outerError) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">"外层catch"</span>, outerError.message);<br>
                &nbsp;&nbsp;}<br>
                }<br><br>
                
                nestedTryCatch();
            </div>
            
            <div class="comparison">
                <div class="comparison-item">
                    <div class="comparison-title">try/catch各部分的作用</div>
                    <ul>
                        <li><strong>try</strong>：包含可能出错的代码</li>
                        <li><strong>catch</strong>：捕获并处理错误</li>
                        <li><strong>finally</strong>：无论是否出错都会执行的代码</li>
                        <li><strong>catch参数</strong>：包含错误信息的Error对象</li>
                        <li><strong>执行顺序</strong>：try → catch（如果出错）→ finally</li>
                    </ul>
                </div>
                
                <div class="comparison-item">
                    <div class="comparison-title">何时使用try/catch</div>
                    <ul>
                        <li><strong>外部数据处理</strong>：JSON.parse(), API调用</li>
                        <li><strong>文件操作</strong>：读写文件（Node.js）</li>
                        <li><strong>用户输入验证</strong>：处理可能无效的输入</li>
                        <li><strong>网络请求</strong>：fetch, XMLHttpRequest</li>
                        <li><strong>类型转换</strong>：parseInt, parseFloat等</li>
                    </ul>
                </div>
            </div>
            
            <h2>Error对象和自定义错误</h2>
            <p>JavaScript的Error对象是所有错误类型的基类，我们可以创建自定义错误类型来处理特定场景。</p>
            
            <div class="code-block">
                <span class="code-comment">// 基本Error对象</span><br>
                <span class="code-keyword">const</span> basicError = <span class="code-keyword">new</span> Error(<span class="code-string">"这是一个基本错误"</span>);<br>
                console.log(basicError.name); <span class="code-comment">// "Error"</span><br>
                console.log(basicError.message); <span class="code-comment">// "这是一个基本错误"</span><br>
                console.log(basicError.stack); <span class="code-comment">// 错误堆栈信息</span><br><br>
                
                <span class="code-comment">// 自定义错误类型</span><br>
                <span class="code-keyword">class</span> ValidationError <span class="code-keyword">extends</span> Error {<br>
                &nbsp;&nbsp;<span class="code-keyword">constructor</span>(message, field) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">super</span>(message);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">this</span>.name = <span class="code-string">'ValidationError'</span>;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">this</span>.field = field;<br>
                &nbsp;&nbsp;}<br>
                }<br><br>
                
                <span class="code-keyword">class</span> NetworkError <span class="code-keyword">extends</span> Error {<br>
                &nbsp;&nbsp;<span class="code-keyword">constructor</span>(message, status) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">super</span>(message);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">this</span>.name = <span class="code-string">'NetworkError'</span>;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">this</span>.status = status;<br>
                &nbsp;&nbsp;}<br>
                }<br><br>
                
                <span class="code-comment">// 使用自定义错误</span><br>
                <span class="code-keyword">function</span> validateEmail(email) {<br>
                &nbsp;&nbsp;<span class="code-keyword">if</span> (!email || !email.includes(<span class="code-string">'@'</span>)) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">throw</span> <span class="code-keyword">new</span> ValidationError(<span class="code-string">'邮箱格式不正确'</span>, <span class="code-string">'email'</span>);<br>
                &nbsp;&nbsp;}<br>
                &nbsp;&nbsp;<span class="code-keyword">return</span> <span class="code-boolean">true</span>;<br>
                }<br><br>
                
                <span class="code-keyword">function</span> handleFormSubmission(formData) {<br>
                &nbsp;&nbsp;<span class="code-keyword">try</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;validateEmail(formData.email);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">'表单验证通过'</span>);<br>
                &nbsp;&nbsp;} <span class="code-keyword">catch</span> (error) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">if</span> (error <span class="code-keyword">instanceof</span> ValidationError) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.error(<span class="code-string">`验证错误 - 字段: ${error.field}, 消息: ${error.message}`</span>);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;} <span class="code-keyword">else</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.error(<span class="code-string">'未知错误:'</span>, error.message);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;}<br>
                }<br><br>
                
                handleFormSubmission({ email: <span class="code-string">'invalid-email'</span> });<br>
                handleFormSubmission({ email: <span class="code-string">'valid@example.com'</span> });
            </div>
            
            <h2>异步错误处理</h2>
            <p>在异步编程中，错误处理有特殊之处，需要特别注意Promise和async/await的错误处理方式。</p>
            
            <div class="code-block">
                <span class="code-comment">// Promise错误处理</span><br>
                <span class="code-keyword">function</span> fetchUserData(userId) {<br>
                &nbsp;&nbsp;<span class="code-keyword">return</span> fetch(<span class="code-string">`/api/users/${userId}`</span>)<br>
                &nbsp;&nbsp;&nbsp;&nbsp;.then(response => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">if</span> (!response.ok) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">throw</span> <span class="code-keyword">new</span> Error(<span class="code-string">`请求失败: ${response.status}`</span>);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> response.json();<br>
                &nbsp;&nbsp;&nbsp;&nbsp;})<br>
                &nbsp;&nbsp;&nbsp;&nbsp;.catch(error => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.error(<span class="code-string">'获取用户数据失败:'</span>, error.message);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">throw</span> error; <span class="code-comment">// 重新抛出错误供上层处理</span><br>
                &nbsp;&nbsp;&nbsp;&nbsp;});<br>
                }<br><br>
                
                <span class="code-comment">// async/await错误处理</span><br>
                <span class="code-keyword">async function</span> processUserData(userId) {<br>
                &nbsp;&nbsp;<span class="code-keyword">try</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> userData = <span class="code-keyword">await</span> fetchUserData(userId);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">'用户数据:'</span>, userData);<br><br>
                
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// 处理用户数据的其他操作</span><br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> processedData = processUser(userData);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> processedData;<br>
                &nbsp;&nbsp;} <span class="code-keyword">catch</span> (error) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.error(<span class="code-string">'处理用户数据时出错:'</span>, error.message);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">throw</span> <span class="code-keyword">new</span> Error(<span class="code-string">`用户${userId}处理失败: ${error.message}`</span>);<br>
                &nbsp;&nbsp;}<br>
                }<br><br>
                
                <span class="code-comment">// 并发异步操作的错误处理</span><br>
                <span class="code-keyword">async function</span> fetchMultipleData() {<br>
                &nbsp;&nbsp;<span class="code-keyword">try</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> results = <span class="code-keyword">await</span> Promise.all([<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fetchUserData(<span class="code-number">1</span>),<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fetchUserData(<span class="code-number">2</span>),<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fetchUserData(<span class="code-number">3</span>)<br>
                &nbsp;&nbsp;&nbsp;&nbsp;]);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">'所有用户数据:'</span>, results);<br>
                &nbsp;&nbsp;} <span class="code-keyword">catch</span> (error) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.error(<span class="code-string">'至少一个请求失败:'</span>, error.message);<br>
                &nbsp;&nbsp;}<br><br>
                
                &nbsp;&nbsp;<span class="code-comment">// 使用Promise.allSettled处理，即使有错误也继续</span><br>
                &nbsp;&nbsp;<span class="code-keyword">const</span> results = <span class="code-keyword">await</span> Promise.allSettled([<br>
                &nbsp;&nbsp;&nbsp;&nbsp;fetchUserData(<span class="code-number">1</span>),<br>
                &nbsp;&nbsp;&nbsp;&nbsp;fetchUserData(<span class="code-number">2</span>),<br>
                &nbsp;&nbsp;&nbsp;&nbsp;fetchUserData(<span class="code-number">999</span>) <span class="code-comment">// 这个会失败，但不影响其他</span><br>
                &nbsp;&nbsp;]);<br><br>
                
                &nbsp;&nbsp;results.forEach((result, index) => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">if</span> (result.status === <span class="code-string">'fulfilled'</span>) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">`用户${index+1}数据获取成功`</span>, result.value);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;} <span class="code-keyword">else</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.error(<span class="code-string">`用户${index+1}数据获取失败`</span>, result.reason.message);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;});<br>
                }
            </div>
            
            <div class="error-example">
                <div class="error-example-title">全局错误处理</div>
                <div class="code-block">
                    <span class="code-comment">// 捕获未处理的Promise拒绝</span><br>
                    window.addEventListener(<span class="code-string">'unhandledrejection'</span>, <span class="code-keyword">function</span>(event) {<br>
                    &nbsp;&nbsp;console.error(<span class="code-string">'未处理的Promise拒绝:'</span>, event.reason);<br>
                    &nbsp;&nbsp;event.preventDefault(); <span class="code-comment">// 阻止默认的控制台错误输出</span><br>
                    });<br><br>
                    
                    <span class="code-comment">// 捕获未处理的异常</span><br>
                    window.addEventListener(<span class="code-string">'error'</span>, <span class="code-keyword">function</span>(event) {<br>
                    &nbsp;&nbsp;console.error(<span class="code-string">'未捕获的错误:'</span>, event.error);<br>
                    &nbsp;&nbsp;event.preventDefault(); <span class="code-comment">// 阻止默认行为</span><br>
                    });<br><br>
                    
                    <span class="code-comment">// 示例：未处理的Promise拒绝</span><br>
                    <span class="code-keyword">const</span> failingPromise = <span class="code-keyword">new</span> Promise((resolve, reject) => {<br>
                    &nbsp;&nbsp;reject(<span class="code-keyword">new</span> Error(<span class="code-string">'这是一个未处理的错误'</span>));<br>
                    });<br><br>
                    
                    <span class="code-comment">// 这个Promise没有catch，会被unhandledrejection事件捕获</span><br>
                    failingPromise.then(data => console.log(data));
                </div>
            </div>
            
            <h2>错误处理最佳实践</h2>
            <p>以下是一些错误处理的最佳实践和注意事项：</p>
            
            <div class="code-block">
                <span class="code-comment">// 1. 创建错误处理工具函数</span><br>
                <span class="code-keyword">function</span> safeOperation(operation, fallbackValue = <span class="code-boolean">null</span>) {<br>
                &nbsp;&nbsp;<span class="code-keyword">return</span> <span class="code-keyword">function</span>(...args) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">try</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> operation.apply(<span class="code-keyword">this</span>, args);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;} <span class="code-keyword">catch</span> (error) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.error(<span class="code-string">'操作失败:'</span>, error.message);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> fallbackValue;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;};<br>
                }<br><br>
                
                <span class="code-comment">// 使用示例</span><br>
                <span class="code-keyword">const</span> safeParse = safeOperation(JSON.parse, {});<br>
                console.log(safeParse(<span class="code-string">'{"valid": "json"}'</span>)); <span class="code-comment">// {valid: "json"}</span><br>
                console.log(safeParse(<span class="code-string">'invalid json'</span>)); <span class="code-comment">// {}</span><br><br>
                
                <span class="code-comment">// 2. 创建错误处理装饰器（模拟）</span><br>
                <span class="code-keyword">function</span> withErrorHandling(targetFunction, errorHandler) {<br>
                &nbsp;&nbsp;<span class="code-keyword">return</span> <span class="code-keyword">function</span>(...args) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">try</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> targetFunction.apply(<span class="code-keyword">this</span>, args);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;} <span class="code-keyword">catch</span> (error) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;errorHandler(error);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">throw</span> error; <span class="code-comment">// 可以选择重新抛出或不抛出</span><br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;};<br>
                }<br><br>
                
                <span class="code-comment">// 3. 错误重试机制</span><br>
                <span class="code-keyword">async function</span> retryAsync(operation, maxRetries = <span class="code-number">3</span>, delay = <span class="code-number">1000</span>) {<br>
                &nbsp;&nbsp;<span class="code-keyword">for</span> (<span class="code-keyword">let</span> i = <span class="code-number">0</span>; i <= maxRetries; i++) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">try</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> <span class="code-keyword">await</span> operation();<br>
                &nbsp;&nbsp;&nbsp;&nbsp;} <span class="code-keyword">catch</span> (error) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">if</span> (i === maxRetries) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.error(<span class="code-string">`操作失败，已重试${maxRetries}次，仍然失败: `</span>, error.message);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">throw</span> error;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>
                
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">`操作失败，${delay}ms后进行第${i+1}次重试...`</span>);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">await</span> <span class="code-keyword">new</span> Promise(resolve => setTimeout(resolve, delay));<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;}<br>
                }<br><br>
                
                <span class="code-comment">// 使用重试机制</span><br>
                <span class="code-keyword">async function</span> unreliableNetworkCall() {<br>
                &nbsp;&nbsp;<span class="code-comment">// 模拟不稳定的网络调用</span><br>
                &nbsp;&nbsp;<span class="code-keyword">if</span> (Math.random() < <span class="code-number">0.7</span>) { <span class="code-comment">// 70% 概率失败</span><br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">throw</span> <span class="code-keyword">new</span> NetworkError(<span class="code-string">"网络连接失败"</span>, <span class="code-number">500</span>);<br>
                &nbsp;&nbsp;}<br>
                &nbsp;&nbsp;<span class="code-keyword">return</span> <span class="code-string">"请求成功"</span>;<br>
                }<br><br>
                
                <span class="code-comment">// retryAsync(unreliableNetworkCall, 3, 1000)</span>
            </div>
            
            <div class="practice">
                <h3>实践练习</h3>
                <ul>
                    <li>创建一个API客户端类，包含完整的错误处理和重试机制</li>
                    <li>实现一个表单验证器，使用自定义错误类型报告不同验证失败</li>
                    <li>编写一个文件处理函数，处理各种可能的错误情况</li>
                    <li>实现一个Promise包装器，自动处理错误并提供默认值</li>
                    <li>创建一个错误日志记录系统，支持不同级别的错误记录</li>
                </ul>
            </div>
            
            <h2>错误处理的常见陷阱</h2>
            <p>在错误处理中，有一些常见的陷阱需要注意：</p>
            <ul>
                <li>捕获错误后不处理或记录</li>
                <li>在异步操作中忘记处理错误</li>
                <li>过于宽泛的错误捕获，掩盖了具体的错误信息</li>
                <li>在循环中不正确地处理错误</li>
                <li>忽略异步错误的传播</li>
            </ul>
        </div>
        
        <nav>
            <a href="es6-features.html" class="nav-link">← 上一课：ES6+新特性</a>
            <a href="index.html" class="nav-link">返回进阶首页</a>
            <a href="modules.html" class="nav-link">下一课：模块化 →</a>
        </nav>
        
        <footer>
            <p>JavaScript快速上手 - 从零到大神，成为JS高手</p>
        </footer>
    </div>
</body>
</html>