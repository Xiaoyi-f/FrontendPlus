<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>异步编程 - JavaScript快速上手</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: #f8f9fa;
            color: #333;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .breadcrumb {
            color: #7f8c8d;
            margin-bottom: 15px;
        }
        
        .content {
            margin-bottom: 30px;
        }
        
        h2 {
            color: #34495e;
            margin: 25px 0 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        
        h3 {
            color: #555;
            margin: 20px 0 12px;
        }
        
        p {
            margin-bottom: 15px;
            line-height: 1.8;
        }
        
        .code-block {
            background: #2d3648;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        
        .code-comment {
            color: #637777;
        }
        
        .code-keyword {
            color: #c792ea;
        }
        
        .code-variable {
            color: #ffcb6b;
        }
        
        .code-string {
            color: #c3e88d;
        }
        
        .code-number {
            color: #f78c6c;
        }
        
        .code-function {
            color: #82aaff;
        }
        
        .code-boolean {
            color: #ff5874;
        }
        
        .async-diagram {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        
        .key-features {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin: 25px 0;
        }
        
        .key-features h3 {
            color: #0d47a1;
            margin-bottom: 15px;
        }
        
        .key-features ul {
            padding-left: 25px;
        }
        
        .key-features li {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .comparison-item {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .comparison-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .practice {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 8px;
            margin: 25px 0;
        }
        
        .practice h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }
        
        .practice ul {
            padding-left: 25px;
        }
        
        .practice li {
            margin-bottom: 10px;
        }
        
        .async-example {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        
        .async-example-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        nav {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .nav-link {
            display: inline-block;
            padding: 10px 20px;
            background: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin: 0 10px;
        }
        
        .nav-link:hover {
            background: #2980b9;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="breadcrumb">JavaScript快速上手 > 进阶特性 > 异步编程</div>
            <h1>异步编程</h1>
        </header>
        
        <div class="content">
            <p>异步编程是JavaScript的核心特性之一，它允许我们在执行长时间运行的操作（如网络请求、文件读取）时不会阻塞主线程。掌握异步编程对于开发响应式应用至关重要。</p>
            
            <div class="key-features">
                <h3>异步编程概览</h3>
                <ul>
                    <li><strong>事件循环</strong>：JavaScript的异步执行模型</li>
                    <li><strong>回调函数</strong>：最早的异步处理方式</li>
                    <li><strong>Promise</strong>：解决回调地狱问题</li>
                    <li><strong>async/await</strong>：更优雅的异步处理语法</li>
                    <li><strong>错误处理</strong>：异步操作中的错误捕获</li>
                    <li><strong>并发处理</strong>：Promise.all()、Promise.race()等</li>
                </ul>
            </div>
            
            <h2>JavaScript执行模型</h2>
            <p>JavaScript是单线程的，使用事件循环来处理异步操作。理解执行栈、事件循环和回调队列是掌握异步编程的关键。</p>
            
            <div class="code-block">
                <span class="code-comment">// JavaScript执行示例</span><br>
                console.log(<span class="code-string">'1. 同步代码'</span>);<br><br>
                
                setTimeout(() => {<br>
                &nbsp;&nbsp;console.log(<span class="code-string">'4. 异步回调 (setTimeout)'</span>);<br>
                }, <span class="code-number">0</span>);<br><br>
                
                <span class="code-keyword">const</span> promise = <span class="code-keyword">new</span> Promise((resolve) => {<br>
                &nbsp;&nbsp;console.log(<span class="code-string">'2. Promise构造函数同步执行'</span>);<br>
                &nbsp;&nbsp;resolve(<span class="code-string">'5. Promise解析'</span>);<br>
                });<br><br>
                
                promise.then(value => {<br>
                &nbsp;&nbsp;console.log(value);<br>
                });<br><br>
                
                console.log(<span class="code-string">'3. 同步代码继续'</span>);<br><br>
                
                <span class="code-comment">// 输出顺序：</span><br>
                <span class="code-comment">// 1. 同步代码</span><br>
                <span class="code-comment">// 2. Promise构造函数同步执行</span><br>
                <span class="code-comment">// 3. 同步代码继续</span><br>
                <span class="code-comment">// 5. Promise解析</span><br>
                <span class="code-comment">// 4. 异步回调 (setTimeout)</span>
            </div>
            
            <div class="async-diagram">
                <h3>事件循环示意图</h3>
                <p>执行栈 → Web APIs → 回调队列 → 事件循环 → 执行栈</p>
                <pre>
    执行栈 (Call Stack)
        ↓
    Web APIs (DOM, setTimeout, HTTP等)
        ↓
    回调队列 (Callback Queue)
        ↓
    事件循环 (Event Loop) → 执行栈
                </pre>
            </div>
            
            <h2>回调函数</h2>
            <p>回调函数是最原始的异步处理方式，但容易导致回调地狱问题。</p>
            
            <div class="code-block">
                <span class="code-comment">// 简单的异步回调</span><br>
                <span class="code-keyword">function</span> fetchData(callback) {<br>
                &nbsp;&nbsp;setTimeout(() => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> data = { id: <span class="code-number">1</span>, name: <span class="code-string">"示例数据"</span> };<br>
                &nbsp;&nbsp;&nbsp;&nbsp;callback(data);<br>
                &nbsp;&nbsp;}, <span class="code-number">1000</span>);<br>
                }<br><br>
                
                fetchData((data) => {<br>
                &nbsp;&nbsp;console.log(data); <span class="code-comment">// {id: 1, name: "示例数据"}</span><br>
                });<br><br>
                
                <span class="code-comment">// 回调地狱示例</span><br>
                fetchData((data1) => {<br>
                &nbsp;&nbsp;processData1(data1, (data2) => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;processData2(data2, (data3) => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processData3(data3, (data4) => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// 嵌套层级过深，难以维护</span><br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(data4);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>
                &nbsp;&nbsp;&nbsp;&nbsp;});<br>
                &nbsp;&nbsp;});<br>
                });
            </div>
            
            <h2>Promise</h2>
            <p>Promise是ES6引入的异步编程解决方案，解决了回调地狱问题，提供更清晰的错误处理。</p>
            
            <div class="code-block">
                <span class="code-comment">// 创建Promise</span><br>
                <span class="code-keyword">function</span> fetchDataAsync() {<br>
                &nbsp;&nbsp;<span class="code-keyword">return</span> <span class="code-keyword">new</span> Promise((resolve, reject) => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;setTimeout(() => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> success = <span class="code-boolean">true</span>;<br><br>
                
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">if</span> (success) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> data = { id: <span class="code-number">1</span>, name: <span class="code-string">"Promise数据"</span> };<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolve(data);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span class="code-keyword">else</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reject(<span class="code-keyword">new</span> Error(<span class="code-string">"获取数据失败"</span>));<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}, <span class="code-number">1000</span>);<br>
                &nbsp;&nbsp;});<br>
                }<br><br>
                
                <span class="code-comment">// 使用Promise</span><br>
                fetchDataAsync()<br>
                &nbsp;&nbsp;.then(data => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">'成功:'</span>, data);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> processAsync(data); <span class="code-comment">// 返回另一个Promise</span><br>
                &nbsp;&nbsp;})<br>
                &nbsp;&nbsp;.then(processedData => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">'处理后:'</span>, processedData);<br>
                &nbsp;&nbsp;})<br>
                &nbsp;&nbsp;.catch(error => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.error(<span class="code-string">'错误:'</span>, error.message);<br>
                &nbsp;&nbsp;})<br>
                &nbsp;&nbsp;.finally(() => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">'Promise执行完成'</span>);<br>
                &nbsp;&nbsp;});
            </div>
            
            <div class="comparison">
                <div class="comparison-item">
                    <div class="comparison-title">Promise状态</div>
                    <ul>
                        <li><strong>pending</strong>：初始状态，既未成功也未失败</li>
                        <li><strong>fulfilled</strong>：操作成功完成</li>
                        <li><strong>rejected</strong>：操作失败</li>
                        <li>状态只能从pending到fulfilled或rejected，不可逆</li>
                    </ul>
                </div>
                
                <div class="comparison-item">
                    <div class="comparison-title">Promise方法</div>
                    <ul>
                        <li><strong>Promise.all()</strong>：所有Promise都成功时才成功</li>
                        <li><strong>Promise.allSettled()</strong>：等待所有Promise完成，无论成功或失败</li>
                        <li><strong>Promise.race()</strong>：最快完成的Promise决定结果</li>
                        <li><strong>Promise.any()</strong>：第一个成功的Promise决定结果</li>
                    </ul>
                </div>
            </div>
            
            <h2>async/await</h2>
            <p>async/await是ES2017引入的语法糖，让异步代码看起来像同步代码，提高了可读性和可维护性。</p>
            
            <div class="code-block">
                <span class="code-comment">// 使用async/await</span><br>
                <span class="code-keyword">async</span> <span class="code-keyword">function</span> fetchUserData() {<br>
                &nbsp;&nbsp;<span class="code-keyword">try</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">'开始获取用户数据...'</span>);<br><br>
                
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> userResponse = <span class="code-keyword">await</span> fetch(<span class="code-string">'/api/user'</span>);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> user = <span class="code-keyword">await</span> userResponse.json();<br><br>
                
                &nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">'用户信息:'</span>, user);<br><br>
                
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> postsResponse = <span class="code-keyword">await</span> fetch(<span class="code-string">`/api/user/${user.id}/posts`</span>);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> posts = <span class="code-keyword">await</span> postsResponse.json();<br><br>
                
                &nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">'用户文章:'</span>, posts);<br><br>
                
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> { user, posts };<br>
                &nbsp;&nbsp;} <span class="code-keyword">catch</span> (error) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.error(<span class="code-string">'获取数据失败:'</span>, error.message);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">throw</span> error;<br>
                &nbsp;&nbsp;}<br>
                }<br><br>
                
                <span class="code-comment">// 调用async函数</span><br>
                fetchUserData()<br>
                &nbsp;&nbsp;.then(result => console.log(<span class="code-string">'最终结果:'</span>, result))<br>
                &nbsp;&nbsp;.catch(error => console.error(<span class="code-string">'错误:'</span>, error));<br><br>
                
                <span class="code-comment">// 并行执行多个异步操作</span><br>
                <span class="code-keyword">async</span> <span class="code-keyword">function</span> fetchMultipleData() {<br>
                &nbsp;&nbsp;<span class="code-keyword">try</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> [userData, postsData, commentsData] = <span class="code-keyword">await</span> Promise.all([<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fetch(<span class="code-string">'/api/user'</span>).then(res => res.json()),<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fetch(<span class="code-string">'/api/posts'</span>).then(res => res.json()),<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fetch(<span class="code-string">'/api/comments'</span>).then(res => res.json())<br>
                &nbsp;&nbsp;&nbsp;&nbsp;]);<br><br>
                
                &nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">'所有数据:'</span>, { userData, postsData, commentsData });<br>
                &nbsp;&nbsp;} <span class="code-keyword">catch</span> (error) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.error(<span class="code-string">'获取数据失败:'</span>, error);<br>
                &nbsp;&nbsp;}<br>
                }
            </div>
            
            <div class="async-example">
                <div class="async-example-title">实际应用：API请求封装</div>
                <div class="code-block">
                    <span class="code-comment">// API请求类</span><br>
                    <span class="code-keyword">class</span> ApiClient {<br>
                    &nbsp;&nbsp;<span class="code-keyword">constructor</span>(baseUrl) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">this</span>.baseUrl = baseUrl;<br>
                    &nbsp;&nbsp;}<br><br>
                    
                    &nbsp;&nbsp;<span class="code-comment">// 通用请求方法</span><br>
                    &nbsp;&nbsp;async request(endpoint, options = {}) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> url = <span class="code-string">`${<span class="code-keyword">this</span>.baseUrl}${endpoint}`</span>;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> config = {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers: {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'Content-Type'</span>: <span class="code-string">'application/json'</span>,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...options.headers,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...options,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;};<br><br>
                    
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">try</span> {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> response = <span class="code-keyword">await</span> fetch(url, config);<br><br>
                    
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">if</span> (!response.ok) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">throw</span> <span class="code-keyword">new</span> Error(<span class="code-string">`HTTP错误! 状态: ${response.status}`</span>);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>
                    
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> data = <span class="code-keyword">await</span> response.json();<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> data;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;} <span class="code-keyword">catch</span> (error) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.error(<span class="code-string">'请求失败:'</span>, error);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">throw</span> error;<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                    &nbsp;&nbsp;}<br><br>
                    
                    &nbsp;&nbsp;async get(endpoint) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> <span class="code-keyword">this</span>.request(endpoint, { method: <span class="code-string">'GET'</span> });<br>
                    &nbsp;&nbsp;}<br><br>
                    
                    &nbsp;&nbsp;async post(endpoint, data) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> <span class="code-keyword">this</span>.request(endpoint, {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method: <span class="code-string">'POST'</span>,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body: JSON.stringify(data),<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;});<br>
                    &nbsp;&nbsp;}<br><br>
                    
                    &nbsp;&nbsp;async put(endpoint, data) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> <span class="code-keyword">this</span>.request(endpoint, {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method: <span class="code-string">'PUT'</span>,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body: JSON.stringify(data),<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;});<br>
                    &nbsp;&nbsp;}<br><br>
                    
                    &nbsp;&nbsp;async delete(endpoint) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> <span class="code-keyword">this</span>.request(endpoint, { method: <span class="code-string">'DELETE'</span> });<br>
                    &nbsp;&nbsp;}<br>
                    }<br><br>
                    
                    <span class="code-comment">// 使用示例</span><br>
                    <span class="code-keyword">const</span> api = <span class="code-keyword">new</span> ApiClient(<span class="code-string">'https://jsonplaceholder.typicode.com'</span>);<br><br>
                    
                    <span class="code-keyword">async</span> <span class="code-keyword">function</span> example() {<br>
                    &nbsp;&nbsp;<span class="code-keyword">try</span> {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// 获取用户列表</span><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> users = <span class="code-keyword">await</span> api.get(<span class="code-string">'/users'</span>);<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">'用户列表:'</span>, users.slice(<span class="code-number">0</span>, <span class="code-number">3</span>)); <span class="code-comment">// 只显示前3个</span><br><br>
                    
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// 创建新用户</span><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> newUser = <span class="code-keyword">await</span> api.post(<span class="code-string">'/users'</span>, {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: <span class="code-string">'张三'</span>,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;email: <span class="code-string">'zhangsan@example.com'</span><br>
                    &nbsp;&nbsp;&nbsp;&nbsp;});<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">'新用户:'</span>, newUser);<br>
                    &nbsp;&nbsp;} <span class="code-keyword">catch</span> (error) {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;console.error(<span class="code-string">'示例执行失败:'</span>, error);<br>
                    &nbsp;&nbsp;}<br>
                    }<br><br>
                    
                    example();
                </div>
            </div>
            
            <h2>并发处理</h2>
            <p>使用Promise提供的方法可以有效处理并发操作：</p>
            
            <div class="code-block">
                <span class="code-comment">// 模拟多个异步请求</span><br>
                <span class="code-keyword">function</span> fetchWithDelay(data, delay) {<br>
                &nbsp;&nbsp;<span class="code-keyword">return</span> <span class="code-keyword">new</span> Promise(resolve => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;setTimeout(() => resolve(data), delay);<br>
                &nbsp;&nbsp;});<br>
                }<br><br>
                
                <span class="code-comment">// Promise.all - 所有请求都成功才返回</span><br>
                <span class="code-keyword">async</span> <span class="code-keyword">function</span> exampleAll() {<br>
                &nbsp;&nbsp;<span class="code-keyword">try</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">const</span> results = <span class="code-keyword">await</span> Promise.all([<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fetchWithDelay(<span class="code-string">'数据1'</span>, <span class="code-number">1000</span>),<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fetchWithDelay(<span class="code-string">'数据2'</span>, <span class="code-number">500</span>),<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fetchWithDelay(<span class="code-string">'数据3'</span>, <span class="code-number">1500</span>)<br>
                &nbsp;&nbsp;&nbsp;&nbsp;]);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">'Promise.all结果:'</span>, results); <span class="code-comment">// ['数据1', '数据2', '数据3']</span><br>
                &nbsp;&nbsp;} <span class="code-keyword">catch</span> (error) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;console.error(<span class="code-string">'Promise.all错误:'</span>, error);<br>
                &nbsp;&nbsp;}<br>
                }<br><br>
                
                <span class="code-comment">// Promise.race - 最快完成的请求决定结果</span><br>
                <span class="code-keyword">async</span> <span class="code-keyword">function</span> exampleRace() {<br>
                &nbsp;&nbsp;<span class="code-keyword">const</span> result = <span class="code-keyword">await</span> Promise.race([<br>
                &nbsp;&nbsp;&nbsp;&nbsp;fetchWithDelay(<span class="code-string">'快数据'</span>, <span class="code-number">100</span>),<br>
                &nbsp;&nbsp;&nbsp;&nbsp;fetchWithDelay(<span class="code-string">'慢数据'</span>, <span class="code-number">1000</span>)<br>
                &nbsp;&nbsp;]);<br>
                &nbsp;&nbsp;console.log(<span class="code-string">'Promise.race结果:'</span>, result); <span class="code-comment">// '快数据'</span><br>
                }<br><br>
                
                <span class="code-comment">// Promise.allSettled - 等待所有请求完成，无论成功或失败</span><br>
                <span class="code-keyword">async</span> <span class="code-keyword">function</span> exampleAllSettled() {<br>
                &nbsp;&nbsp;<span class="code-keyword">const</span> promises = [<br>
                &nbsp;&nbsp;&nbsp;&nbsp;Promise.resolve(<span class="code-string">'成功1'</span>),<br>
                &nbsp;&nbsp;&nbsp;&nbsp;Promise.reject(<span class="code-keyword">new</span> Error(<span class="code-string">'失败'</span>)),<br>
                &nbsp;&nbsp;&nbsp;&nbsp;Promise.resolve(<span class="code-string">'成功2'</span>)<br>
                &nbsp;&nbsp;];<br><br>
                
                &nbsp;&nbsp;<span class="code-keyword">const</span> results = <span class="code-keyword">await</span> Promise.allSettled(promises);<br>
                &nbsp;&nbsp;console.log(<span class="code-string">'Promise.allSettled结果:'</span>, results);<br><br>
                
                &nbsp;&nbsp;<span class="code-comment">// 处理结果</span><br>
                &nbsp;&nbsp;results.forEach((result, index) => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">if</span> (result.status === <span class="code-string">'fulfilled'</span>) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">`Promise ${index} 成功: ${result.value}`</span>);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;} <span class="code-keyword">else</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(<span class="code-string">`Promise ${index} 失败: ${result.reason.message}`</span>);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;});<br>
                }<br><br>
                
                exampleAll();<br>
                exampleRace();<br>
                exampleAllSettled();
            </div>
            
            <div class="practice">
                <h3>实践练习</h3>
                <ul>
                    <li>创建一个模拟的API服务，实现用户注册、登录和获取用户信息的功能</li>
                    <li>实现一个图片加载器，使用Promise处理图片加载的异步操作</li>
                    <li>编写一个批量请求处理器，可以并发处理多个API请求</li>
                    <li>创建一个定时任务系统，使用async/await实现延迟执行</li>
                    <li>实现一个简单的Promise库，包含Promise.all, Promise.race等方法</li>
                </ul>
            </div>
            
            <h2>错误处理最佳实践</h2>
            <p>在异步编程中，正确的错误处理至关重要：</p>
            <ul>
                <li>始终使用try/catch包装await调用</li>
                <li>在Promise链中使用.catch()处理错误</li>
                <li>避免在异步函数中忽略错误</li>
                <li>记录错误信息以便调试</li>
                <li>实现适当的重试机制</li>
            </ul>
        </div>
        
        <nav>
            <a href="prototypes.html" class="nav-link">← 上一课：原型与继承</a>
            <a href="es6-features.html" class="nav-link">下一课：ES6+新特性 →</a>
        </nav>
        
        <footer>
            <p>JavaScript快速上手 - 从零到大神，成为JS高手</p>
        </footer>
    </div>
</body>
</html>